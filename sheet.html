<script>
  // ---------- ARMOUR CARD BUILDER ----------
  function createArmourCard(data){
    // No default header widgets from the base
    const s = createBaseCardSkeleton('armour', data, {
      headerGearBonus:false,
      headerDamage:false
    });

    /* -------- Header row: Armour Bonus (number + dice) -------- */
    (function addArmourBonusHeader(){
      const row   = mkDiv('hdr-row');
      const label = mkDiv('hdr-label'); label.textContent = 'Armour Bonus';

      const armHdr = mkInput('number','arm-input-header', (data.armor ?? data.armour ?? 0));
      armHdr.name = 'armor';

      const roll = document.createElement('img');
      roll.src = 'img/roll_icon.png';
      roll.alt = 'Roll';
      roll.title = 'Add Armour Bonus to dice pool';
      roll.className = 'gb-roll hdr-15';

      const wrap = mkDiv('gb-wrap');
      wrap.append(armHdr, roll);
      row.append(label, wrap);
      s.stackWrap.appendChild(row);

      // Wire dice -> pool
      roll.addEventListener('click', () => {
        roll.classList.remove('is-animating'); void roll.offsetWidth; roll.classList.add('is-animating');
        roll.addEventListener('animationend', ()=> roll.classList.remove('is-animating'), {once:true});
        const v = parseInt(armHdr.value, 10) || 0;
        if (v && typeof window.changePool === 'function') window.changePool(+v);
      });

      // We'll sync this to the body "Armour Value" input we add below.
      s._armHdr = armHdr;
    })();

    /* -------- Body: Line 1 (boxed): Coverage | Armour Value | Penalties -------- */
    const r1 = mkDiv('field-row boxed');

    const cov = mkInput('text','enc-text', data.coverage || ''); cov.name='coverage';

    // Keep small number look via CSS scope (see style block)
    const av  = mkInput('number','enc-input', (data.armor ?? data.armour ?? 0)); av.name='armor';

    const pen = mkInput('text','enc-text', data.penalty || ''); pen.name='penalty';

    r1.append(
      box('Coverage', cov),
      box('Armour Value', av),
      box('Penalties', pen)
    );
    s.rows.appendChild(r1);

    /* Two-way sync: header <-> body Armour Value */
    if (s._armHdr){
      const hdrToBody = () => { av.value = s._armHdr.value; };
      const bodyToHdr = () => { s._armHdr.value = av.value || '0'; };
      s._armHdr.addEventListener('input', hdrToBody);
      av.addEventListener('input', bodyToHdr);
      bodyToHdr(); // initialize header from body
    }

    /* -------- Body: Line 2 (boxed): W/S only -------- */
    const wsRow = buildWSRowBoxed(data, { inlineGearBonus:false, inlineDamage:false });
    s.rows.appendChild(wsRow);

    return s.card;
  }
</script>
