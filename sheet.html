<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GxD6 Character Sheet</title>

    <style>
@font-face { font-family: 'DominicanSmall'; src: url('fonts/DOMISC__.TTF') format('truetype'); }
@font-face { font-family: 'Dominican'; src: url('fonts/DOMINICA.TTF') format('truetype'); }
@font-face { font-family: 'DeutschGothic'; src: url('fonts/DeutschGothic.ttf') format('truetype'); }

body {
  font-family: 'DominicanSmall', Georgia, serif;
  background: url('img/GXD6 Greyscale paper background.jpg') center/cover fixed;
  padding: 20px;
  color: black;
}

h3 {
  font-family: 'DominicanSmall', serif;
  font-variant: small-caps;
  text-align: center;
  margin: 0 0 5px 0;
}

input[type="number"] {
  font-family: 'DeutschGothic', monospace;
  font-size: 16px;
  width: 30px;
  text-align: center;
  -moz-appearance: textfield;
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.sheet-container {
  width: 800px;
  margin: 0 auto;
}

.attribute-skill-block-fixed {
  width: 540px;
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 20px;
}

.attribute-box {
  flex: 0 0 260px;
  background: rgba(255,255,255,0.85);
  padding: 10px;
  border: 1px solid #000;
}

.attr-icon-container {
  position: relative;
  width: 120px;
  height: auto;
  margin: 0 auto 10px;
}

.attr-icon-container img {
  width: 100%;
  display: block;
}

/* Pips overlayed on image */
.pips {
  position: absolute;
  top: 47%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  gap: 8px;
}

.pip-base, .pip-current {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid #000;
  background: rgba(255, 255, 255, 0.85);
  display: flex;
  justify-content: center;
  align-items: center;
}

.pip-base input, .pip-current input {
  border: none;
  background: transparent;
  width: 30px;
  height: 30px;
  font-family: 'DeutschGothic', monospace;
  font-size: 16px;
  text-align: center;
}

.attribute-box label {
  display: flex;
  justify-content: space-between;
  font-family: 'Dominican', serif;
  font-size: 14px;
  margin-bottom: 4px;
}

.attribute-box label input {
  width: 30px;
}
</style>
</head>
<body>
<div class="sheet-container">
  <div id="loginForm">
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="signUp()">Sign Up</button>
    <button onclick="signIn()">Sign In</button>
  </div>
  <button onclick="signOutUser()">Sign Out</button>
  <button onclick="deleteAccount()">Delete Account</button>
  <button onclick="deleteCharacter()">Delete Character</button>

  <div class="flex-row">
    <div class="field"><label>Character Name<input type="text" id="charName"></label></div>
    <div class="field"><label>Gender<input type="text" id="gender"></label></div>
    <div class="field"><label>Saved<select id="characterSelect"><option value="">--Select--</option></select></label></div>
    <div class="button-row">
      <button onclick="saveCharacter()">Save</button>
      <button onclick="loadCharacter()">Load</button>
    </div>
  </div>

  <div class="flex-row">
    <div class="field"><label>Archetypes<input id="archetype1"><input id="archetype2"></label></div>
    <div class="field"><label>Professions<input id="profession1"><input id="profession2"></label></div>
    <div class="field"><label>XP<input type="number" id="xp"></label></div>
  </div>

  <!-- Fixed 2x2 Attribute Grid -->
 <div class="attribute-skill-block-fixed">
  <!-- Brawn -->
  <div class="attribute-box">
    <h3>Brawn</h3>
    <div class="attr-icon-container">
      <img src="img/GXD6 BRAWN full.png" alt="Brawn Icon">
      <div class="pips">
        <span class="pip-base"><input type="number" id="brawn" min="1" max="5" /></span>
        <span class="pip-current"><input type="number" id="brawnCurrent" min="0" max="5" /></span>
      </div>
    </div>
    <label>Endurance <input id="endurance" type="number" /></label>
    <label>Fight <input id="fight" type="number" /></label>
    <label>Might <input id="might" type="number" /></label>
  </div>

  <!-- Agility -->
  <div class="attribute-box">
    <h3>Agility</h3>
    <div class="attr-icon-container">
      <img src="img/GXD6 AGILITY full.png" alt="Agility Icon">
      <div class="pips">
        <span class="pip-base"><input type="number" id="agility" min="1" max="5" /></span>
        <span class="pip-current"><input type="number" id="agilityCurrent" min="0" max="5" /></span>
      </div>
    </div>
    <label>Marksmanship <input id="marksmanship" type="number" /></label>
    <label>Mobility <input id="mobility" type="number" /></label>
    <label>Precision <input id="precision" type="number" /></label>
  </div>

  <!-- Wits -->
  <div class="attribute-box">
    <h3>Wits</h3>
    <div class="attr-icon-container">
      <img src="img/GXD6 WITS full.png" alt="Wits Icon">
      <div class="pips">
        <span class="pip-base"><input type="number" id="wits" min="1" max="5" /></span>
        <span class="pip-current"><input type="number" id="witsCurrent" min="0" max="5" /></span>
      </div>
    </div>
    <label>Heal <input id="heal" type="number" /></label>
    <label>Insight <input id="insight" type="number" /></label>
    <label>Logic <input id="logic" type="number" /></label>
    <label>Survival <input id="survival" type="number" /></label>
    <label>Vigilance <input id="vigilance" type="number" /></label>
  </div>

  <!-- Will -->
  <div class="attribute-box">
    <h3>Will</h3>
    <div class="attr-icon-container">
      <img src="img/GXD6 WILL full.png" alt="Will Icon">
      <div class="pips">
        <span class="pip-base"><input type="number" id="will" min="1" max="5" /></span>
        <span class="pip-current"><input type="number" id="willCurrent" min="0" max="5" /></span>
      </div>
    </div>
    <label>Inspire <input id="inspire" type="number" /></label>
    <label>Manipulate <input id="manipulate" type="number" /></label>
    <label>Resolve <input id="resolve" type="number" /></label>
  </div>
</div>

  <div class="conditions">
    <label><input type="checkbox" id="starving"> Starving</label>
    <label><input type="checkbox" id="sleepless"> Sleepless</label>
    <label><input type="checkbox" id="dehydrated"> Dehydrated</label>
    <label><input type="checkbox" id="hypothermic"> Hypothermic</label>
  </div>

  <div class="gear-notes"><label>Gear / Notes<textarea id="notes"></textarea></label></div>
</div>

<!-- Firebase Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, doc, getDoc, setDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Initialize Firebase
const config = {
  apiKey: "AIzaSyDVINPqS-nMiWEs7RvabEqKuuUrii2S2MM",
  authDomain: "gxd6-character-sheet.firebaseapp.com",
  projectId: "gxd6-character-sheet",
  storageBucket: "gxd6-character-sheet.firebasestorage.app",
  messagingSenderId: "761778638151",
  appId: "1:761778638151:web:06a1d72423a7e980889062"
};

const app = initializeApp(config);
const auth = getAuth(app);
const db = getFirestore(app);
const selectEl = document.getElementById("characterSelect");
const loginForm = document.getElementById("loginForm");

onAuthStateChanged(auth, user => {
  if (user) {
    loginForm.style.display = "none";
    populateCharacterList(user.uid);
  } else {
    loginForm.style.display = "block";
    selectEl.innerHTML = '<option value="">--Select--</option>';
  }
});

// AUTH HELPERS
window.signUp = async () => {
  const email = document.getElementById("email").value;
  const pw = document.getElementById("password").value;
  try {
    await createUserWithEmailAndPassword(auth, email, pw);
    alert("‚úÖ Signed up!");
  } catch (err) {
    console.error("Sign up error:", err);
    alert("‚ùå Sign up failed: " + err.message);
  }
};

window.signIn = async () => {
  const email = document.getElementById("email").value;
  const pw = document.getElementById("password").value;
  try {
    await signInWithEmailAndPassword(auth, email, pw);
    alert("‚úÖ Signed in!");
  } catch (err) {
    console.error("Sign in error:", err);
    alert("‚ùå Sign in failed: " + err.message);
  }
};

window.signOutUser = async () => {
  try {
    await signOut(auth);
    alert("‚úÖ Signed out");
  } catch (err) {
    console.error("Sign out error:", err);
    alert("‚ùå Sign out failed: " + err.message);
  }
};

window.deleteAccount = async () => {
  const user = auth.currentUser;
  if (!user) return alert("Not signed in");
  if (!confirm("Delete your account and all characters?")) return;
  try {
    await deleteUser(user);
    alert("‚úÖ Account deleted");
  } catch (err) {
    console.error("Account delete error:", err);
    alert("‚ùå Delete failed: " + err.message);
  }
};

// FIRESTORE
async function populateCharacterList(uid) {
  const selectEl = document.getElementById("characterSelect");
  selectEl.innerHTML = '<option value="">-- Select Character --</option>';
  try {
    const snap = await getDocs(collection(db, "users", uid, "characters"));
    snap.forEach(docSnap => {
      const opt = document.createElement("option");
      opt.value = docSnap.id;
      opt.text = docSnap.id;
      selectEl.appendChild(opt);
    });
  } catch (err) {
    console.error("List error:", err);
  }
}

window.saveCharacter = async () => {
  const user = auth.currentUser;
  if (!user) return alert("Sign in first");
  const name = document.getElementById("charName").value.trim();
  if (!name) return alert("Enter character name");

  const data = {
    name,
    gender: document.getElementById("gender").value,
    archetype1: document.getElementById("archetype1").value,
    archetype2: document.getElementById("archetype2").value,
    profession1: document.getElementById("profession1").value,
    profession2: document.getElementById("profession2").value,
    xp: +document.getElementById("xp").value || 0,
    brawn: +document.getElementById("brawn").value || 0,
    brawnCurrent: +document.getElementById("brawnCurrent").value || 0,
    agility: +document.getElementById("agility").value || 0,
    agilityCurrent: +document.getElementById("agilityCurrent").value || 0,
    wits: +document.getElementById("wits").value || 0,
    witsCurrent: +document.getElementById("witsCurrent").value || 0,
    will: +document.getElementById("will").value || 0,
    willCurrent: +document.getElementById("willCurrent").value || 0,
    skills: {
      endurance: +document.getElementById("endurance").value || 0,
      fight: +document.getElementById("fight").value || 0,
      might: +document.getElementById("might").value || 0,
      marksmanship: +document.getElementById("marksmanship").value || 0,
      mobility: +document.getElementById("mobility").value || 0,
      precision: +document.getElementById("precision").value || 0,
      heal: +document.getElementById("heal").value || 0,
      insight: +document.getElementById("insight").value || 0,
      logic: +document.getElementById("logic").value || 0,
      survival: +document.getElementById("survival").value || 0,
      vigilance: +document.getElementById("vigilance").value || 0,
      inspire: +document.getElementById("inspire").value || 0,
      manipulate: +document.getElementById("manipulate").value || 0,
      resolve: +document.getElementById("resolve").value || 0
    },
    conditions: {
      starving: document.getElementById("starving").checked,
      sleepless: document.getElementById("sleepless").checked,
      dehydrated: document.getElementById("dehydrated").checked,
      hypothermic: document.getElementById("hypothermic").checked
    },
    notes: document.getElementById("notes").value
  };

  try {
    const ref = doc(db, "users", user.uid, "characters", name);
    await setDoc(ref, data);
    alert("‚úÖ Character saved");
    populateCharacterList(user.uid);
  } catch (err) {
    console.error("Save failed:", err);
    alert("‚ùå Save failed: " + err.message);
  }
};

window.loadCharacter = async () => {
  const user = auth.currentUser;
  if (!user) return alert("Sign in first");
  const name = document.getElementById("characterSelect").value || document.getElementById("charName").value.trim();
  if (!name) return alert("Enter/select name");

  try {
    const ref = doc(db, "users", user.uid, "characters", name);
    const snap = await getDoc(ref);
    if (!snap.exists()) return alert("‚ùå Character not found");
    const d = snap.data();

    document.getElementById("charName").value = d.name || '';
    document.getElementById("gender").value = d.gender || '';
    document.getElementById("archetype1").value = d.archetype1 || '';
    document.getElementById("archetype2").value = d.archetype2 || '';
    document.getElementById("profession1").value = d.profession1 || '';
    document.getElementById("profession2").value = d.profession2 || '';
    document.getElementById("xp").value = d.xp || '';
    document.getElementById("brawn").value = d.brawn || '';
    document.getElementById("brawnCurrent").value = d.brawnCurrent || '';
    document.getElementById("agility").value = d.agility || '';
    document.getElementById("agilityCurrent").value = d.agilityCurrent || '';
    document.getElementById("wits").value = d.wits || '';
    document.getElementById("witsCurrent").value = d.witsCurrent || '';
    document.getElementById("will").value = d.will || '';
    document.getElementById("willCurrent").value = d.willCurrent || '';

    for (let s in d.skills) {
      if (document.getElementById(s)) document.getElementById(s).value = d.skills[s];
    }
    for (let c in d.conditions) {
      if (document.getElementById(c)) document.getElementById(c).checked = d.conditions[c];
    }
    document.getElementById("notes").value = d.notes || '';
    alert("‚úÖ Loaded!");
  } catch (err) {
    console.error("Load error:", err);
    alert("‚ùå Load failed: " + err.message);
  }
};

window.deleteCharacter = async () => {
  const user = auth.currentUser;
  const name = document.getElementById("characterSelect").value;
  if (!user || !name) return alert("Select a character");
  if (!confirm(`Delete "${name}"?`)) return;
  try {
    const ref = doc(db, "users", user.uid, "characters", name);
    await deleteDoc(ref);
    alert("üóëÔ∏è Deleted");
    populateCharacterList(user.uid);
  } catch (err) {
    console.error("Delete error:", err);
    alert("‚ùå Delete failed: " + err.message);
  }
};


</script>
</body>
</html>
